<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - app/scripts/modules/highcharts/service.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>app/scripts/modules/highcharts/service.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">60.09</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">510</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">52.09</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.30</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/*
 * Copyright 2013(c) The Ontario Institute for Cancer Research. All rights reserved.
 *
 * This program and the accompanying materials are made available under the terms of the GNU Public
 * License v3.0. You should have received a copy of the GNU General Public License along with this
 * program. If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

&#039;use strict&#039;;

angular.module(&#039;highcharts.services&#039;, []);

angular.module(&#039;highcharts.services&#039;).service(&#039;HighchartsService&#039;, function ($q, LocationService) {
  Highcharts.setOptions({
    chart: {
      backgroundColor: &#039;transparent&#039;
    },
    colors: [
      /*&#039;#9c9ede&#039;, &#039;#6b6ecf&#039;, &#039;#5254a3&#039;, &#039;#393b79&#039;,
       &#039;#cedb9c&#039;, &#039;#b5cf6b&#039;, &#039;#8ca252&#039;, &#039;#637939&#039;,
       &#039;#e7cb94&#039;, &#039;#e7ba52&#039;, &#039;#bd9e39&#039;, &#039;#8c6d31&#039;,
       &#039;#e7969c&#039;, &#039;#d6616b&#039;, &#039;#ad494a&#039;, &#039;#843c39&#039;,
       &#039;#de9ed6&#039;, &#039;#ce6dbd&#039;, &#039;#a55194&#039;, &#039;#7b4173&#039;*/
      &#039;#1693C0&#039;, &#039;#24B2E5&#039;,
      &#039;#E9931C&#039;, &#039;#EDA94A&#039;,
      &#039;#166AA2&#039;, &#039;#1C87CE&#039;,
      &#039;#D33682&#039;, &#039;#DC609C&#039;,
      &#039;#6D72C5&#039;, &#039;#9295D3&#039;,
      &#039;#CE6503&#039;, &#039;#FB7E09&#039;,
      &#039;#1A9900&#039;, &#039;#2C0&#039;
    ],
    yAxis: {
      gridLineColor: &#039;#E0E0E0&#039;,
      labels: {
        style: {
          fontSize: &#039;10px&#039;
        }
      }
    },
    xAxis: {
      gridLineColor: &#039;#E0E0E0&#039;,
      labels: {
        style: {
          fontSize: &#039;10px&#039;
        }
      }
    },
    title: {
      style: {
        color: &#039;hsl(0, 0%, 20%)&#039;,
        fontFamily: &#039;&quot;Open Sans&quot;, &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif&#039;,
        fontWeight: 300,
        fontSize: &#039;1.3rem&#039;
      }
    },
    tooltip: {
      useHTML: true,
      borderWidth: 0,
      borderRadius: 0,
      backgroundColor: &#039;transparent&#039;,
      shadow: false,
      style: {
        //  fontSize: &#039;1rem&#039;
      }
    },
    legend: {
      enabled: false
    },
    loading: {
      style: {
        backgroundColor: &#039;#f5f5f5&#039;
      },
      labelStyle: {
        top: &#039;40%&#039;
      }
    }
  });

//  this.termFacets2HCpie = function(type, facet, terms) {
//    var i, filters, r, term;
//
//    filters = httpService.getCurrentFilters();
//    r = [];
//    for (i = 0; i &lt; terms.length; ++i) {
//      term = {
//        name: terms[i].term,
//        y: terms[i].count,
//        type: type,
//        facet: facet
//      };
//
//      // Only shows active terms if facet active
//      // has filter type - else include
//      if (filters.hasOwnProperty(type)) {
//        // and facet - else include
//        if (filters[type].hasOwnProperty(facet)) {
//          // and active - else don&#039;t include
//          if (filters[type][facet].indexOf(terms[i].term) !== -1) {
//            r.push(term);
//          }
//        } else {
//          r.push(term);
//        }
//      } else {
//        r.push(term);
//      }
//    }
//
//    return r;
//  };
//
//  this.hits2HCpie = function(type, facet, hits, countBy) {
//    var i, r = [];
//
//    for (i = 0; i &lt; hits.length; ++i) {
//      r.push({
//        name: hits[i].fields[facet],
//        y: hits[i].fields[countBy],
//        type: type,
//        facet: facet
//      });
//    }
//
//    return r;
//  };
//
//  this.hits2HCdonut = function(type, facetInner, facetOuter, hits, countBy) {
//    var i, j, iName, colors, inr, outr, innerHits, hit, name, count, hitj, namej, countj, brightness, in_array,
//      in_value;
//
//    colors = Highcharts.getOptions().colors.concat(Highcharts.getOptions().colors);
//    inr = [];
//    outr = [];
//    innerHits = {};
//    // var outerHits = {};
//
//    for (i = 0; i &lt; hits.length; ++i) {
//      hit = hits[i];
//      name = hit.fields[facetInner];
//      count = hit.fields[countBy];
//
//      // Get around projets with undefined primary site
//      if (!name) {
//        name = &#039;Not Available&#039;;
//      }
//
//      if (name.length &amp;&amp; count) {
//        if (innerHits.hasOwnProperty(name)) {
//          innerHits[name] += count;
//        } else {
//          innerHits[name] = count;
//        }
//      }
//    }
//
//    i = 0;
//    for (iName in innerHits) {
//      if (innerHits.hasOwnProperty(iName)) {
//        inr.push({
//          name: iName,
//          y: innerHits[iName],
//          type: type,
//          facet: facetInner,
//          color: colors[i]
//        });
//
//        for (j = 0; j &lt; hits.length; ++j) {
//          hitj = hits[j];
//          namej = hitj.fields[facetOuter];
//          countj = hitj.fields[countBy] ? hitj.fields[countBy] : 0;
//          brightness = 0.3 - (j / hitj.fields[countBy]) / 2;
//
//          in_array = (angular.isArray(hitj.fields[facetInner]) &amp;&amp; hitj.fields[facetInner].indexOf(iName) !== -1);
//          in_value = (!angular.isArray(hitj.fields[facetInner]) &amp;&amp; hitj.fields[facetInner] === iName);
//          if (in_array || in_value) {
//            outr.push({
//              name: namej,
//              y: countj,
//              type: type,
//              facet: facetOuter,
//              color: Highcharts.Color(colors[i]).brighten(brightness).get()
//            });
//          }
//        }
//        i++;
//      }
//    }
//
//    return {
//      inner: inr,
//      outer: outr
//    };
//  };
//
//  this.hits2HCbar = function(hits, x, options) {
//    var i, r, xAxis, hit, data;
//
//    if (!hits) {
//      return {};
//    }
//
//    xAxis = [];
//    r = [];
//    for (i = 0; i &lt; hits.length; ++i) {
//      data = {};
//
//      hit = hits[i];
//      xAxis.push(hit.fields[x]);
//
//      data.y = hit.score;
//
//      // Additional options
//      if (options) {
//        if (options.y) {
//          data.y = hit.fields[options.y];
//        }
//        if (options.linkBase) {
//          data.link = options.linkBase + hit.id;
//        }
//      }
//
//
//      r.push(data);
//    }
//    return {
//      x: xAxis,
//      s: r,
//      hasData: r.length &gt; 9
//    };
//  };
//
//  this.hits2HCstacked = function(hits) {
//    var i, j, s, score, xAxis, series, data, hit, name, affected, total, count;
//
//    if (!hits) {
//      return {};
//    }
//
//    score = &#039;total&#039;;
//    xAxis = [];
//    series = {};
//    data = [];
//
//    // If hits.length &gt; 1, there may be mis-alignments because not all projects have all categories
//    // 1) Get all the series
//    for (i = 0; i &lt; hits.length; i++) {
//      hit = hits[i];
//      xAxis.push(hit.fields.symbol);
//
//      for (j = 0; j &lt; hit.fields[&#039;project._project_id&#039;].length; ++j) {
//        name = hit.fields[&#039;project.project_name&#039;][j];
//        series[name] = [];
//      }
//    }
//
//    // 2) Blank fill all series to have all categories
//    for (s in series) {
//      if (series.hasOwnProperty(s)) {
//        for (i = 0; i &lt; hits.length; i++) {
//          series[s].push({
//            x: i,
//            y: 0,
//            gene_id: hits[i].id
//          });
//        }
//      }
//    }
//
//    // 3) Update
//    for (i = 0; i &lt; hits.length; ++i) {
//      hit = hits[i];
//
//      xAxis.push(hit.fields.symbol);
//      for (j = 0; j &lt; hit.fields[&#039;project._project_id&#039;].length; ++j) {
//        count = 0;
//
//        name = hit.fields[&#039;project.project_name&#039;][j];
//        affected = hit.fields[&#039;project._summary._affected_donor_count&#039;][j];
//        total = hit.fields[&#039;project._summary._total_donor_count&#039;][j];
//
//        if (score === &#039;percentage&#039;) {
//          count = affected / total;
//        } else {
//          count = affected;
//        }
//
//        series[name][i].y = count;
//      }
//    }
//
//    for (s in series) {
//      if (series.hasOwnProperty(s)) {
//        data.push({name: s, data: series[s]});
//      }
//    }
//
//    return {
//      x: xAxis,
//      s: data,
//      hasData: data.length
//    };
//  };

  // new
  this.donut = function (params) {
    var innerPie, innerHits, outerHits, colors, counter, bCounter;

    // Check for required parameters
    [ &#039;data&#039;, &#039;type&#039;, &#039;innerFacet&#039;, &#039;outerFacet&#039;, &#039;countBy&#039;].forEach(function (rp) {
      if (!params.hasOwnProperty(rp)) {
        throw new Error(&#039;Missing required parameter: &#039; + rp);
      }
    });

    colors = Highcharts.getOptions().colors.concat(Highcharts.getOptions().colors);
    innerPie = {};
    innerHits = [];
    outerHits = [];

    // Creates outer ring
    function buildOuterRing(hit) {
      var name, count, brightness, inArray, inValue;

      name = hit[params.outerFacet];
      count = hit[params.countBy] ? hit[params.countBy] : 0;
      brightness = 0.2 - (bCounter / hit[params.countBy]) / 2;

      inArray = (angular.isArray(hit[params.innerFacet]) &amp;&amp; hit[params.innerFacet].indexOf(iName) !== -1);
      inValue = (!angular.isArray(hit[params.innerFacet]) &amp;&amp; hit[params.innerFacet] === iName);
      if (inArray || inValue) {
        outerHits.push({
          name: name,
          y: count,
          type: params.type,
          facet: params.outerFacet,
          color: Highcharts.Color(colors[counter]).brighten(brightness).get()
        });
      }
      bCounter++;
    }

    // Gets the total counts for the inner ring
    function sumInnerPie(hit) {
      var name, count;

      name = hit[params.innerFacet];
      count = hit[params.countBy];

      if (!name) {
        name = &#039;No Data&#039;;
      }

      if (!innerPie.hasOwnProperty(name)) {
        innerPie[name] = 0;
      }
      innerPie[name] += count;
    }

    params.data.forEach(sumInnerPie);

    counter = 0;
    for (var iName in innerPie) {
      if (innerPie.hasOwnProperty(iName)) {
        innerHits.push({
          name: iName,
          y: innerPie[iName],
          type: params.type,
          facet: params.innerFacet,
          color: colors[counter]
        });

        bCounter = 0;
        params.data.forEach(buildOuterRing);
        counter++;
      }
    }

    return {
      inner: innerHits,
      outer: outerHits
    };
  };

  this.pie = function (params) {
    var filters, r = [], term, terms;

    // Check for required parameters
    [ &#039;type&#039;, &#039;facet&#039;, &#039;facets&#039;].forEach(function (rp) {
      if (!params.hasOwnProperty(rp)) {
        throw new Error(&#039;Missing required parameter: &#039; + rp);
      }
    });

    filters = LocationService.filters();

    if (params.facets &amp;&amp; params.facets[params.facet].hasOwnProperty(&#039;terms&#039;)) {
      terms = params.facets[params.facet].terms;
    } else {
      return r;
    }

    terms.forEach(function (item) {
      term = {
        name: item.term,
        y: item.count,
        type: params.type,
        facet: params.facet
      };

      // Only shows active terms if facet active
      // has filter type - else include
      if (filters.hasOwnProperty(params.type)) {
        // and facet - else include
        if (filters[params.type].hasOwnProperty(params.facet)) {
          // and active - else don&#039;t include
          if (filters[params.type][params.facet].is.indexOf(item.term) !== -1) {
            r.push(term);
          }
        } else {
          r.push(term);
        }
      } else {
        r.push(term);
      }
    });

    return r;
  };

  this.bar = function (params) {
    var r, xAxis, data;

    // Check for required parameters
    [ &#039;hits&#039;, &#039;xAxis&#039;, &#039;yValue&#039;].forEach(function (rp) {
      if (!params.hasOwnProperty(rp)) {
        throw new Error(&#039;Missing required parameter: &#039; + rp);
      }
    });

    if (!params.hits) {
      return {};
    }

    xAxis = [];
    r = [];

    params.hits.forEach(function (hit) {
      data = {};

      xAxis.push(hit[params.xAxis]);

      data.y = hit[params.yValue];

      // Additional options
      if (params.options) {
        if (params.options.linkBase) {
          data.link = params.options.linkBase + hit.id;
        }
      }

      if (data.y &gt; 0) {
        r.push(data);
      }
    });

    return {
      x: xAxis,
      s: r,
      hasData: r.length &gt; 9
    };
  };

  this.stacked = function (params) {
//    var data = [], xAxis = [];

    // Check for required parameters
    [ &#039;genes&#039;].forEach(function (rp) {
      if (!params.hasOwnProperty(rp)) {
        throw new Error(&#039;Missing required parameter: &#039; + rp);
      }
    });

    if (!params.genes) {
      return {};
    }

    var r, data = [], xAxis = [], genes = params.genes;

    function sort(a, b) {
      return a.affectedDonorCount - b.affectedDonorCount;
    }

    function add(project) {
      data.push({name: project.name, data: [
        {
          x: i,
          y: project.affectedDonorCount ? project.affectedDonorCount : 0,
          gene_id: gene.id
        }
      ]});
    }

    for (var i = 0; i &lt; genes.length; ++i) {
      var gene = genes[i];

      xAxis.push(gene.symbol);
      gene.projects.sort(sort).forEach(add);
    }

    r = {
      x: xAxis,
      s: data,
      hasData: data.length
    };

    return r;
  };
});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
