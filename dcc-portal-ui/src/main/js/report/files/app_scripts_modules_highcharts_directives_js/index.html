<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - app/scripts/modules/highcharts/directives.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>app/scripts/modules/highcharts/directives.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">60.89</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">568</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">72.55</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">5.08</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/*
 * Copyright 2013(c) The Ontario Institute for Cancer Research. All rights reserved.
 *
 * This program and the accompanying materials are made available under the terms of the GNU Public
 * License v3.0. You should have received a copy of the GNU General Public License along with this
 * program. If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

&#039;use strict&#039;;

angular.module(&#039;highcharts&#039;, [&#039;highcharts.directives&#039;, &#039;highcharts.services&#039;]);

angular.module(&#039;highcharts.directives&#039;, []);

angular.module(&#039;highcharts.directives&#039;).directive(&#039;pie&#039;, function (Facets, $filter) {
  return {
    restrict: &#039;E&#039;,
    replace: true,
    scope: {
      items: &#039;=&#039;,
      groupPercent: &#039;@&#039;
    },
    template: &#039;&lt;span style=&quot;margin: 0 auto&quot;&gt;not working&lt;/span&gt;&#039;,
    link: function ($scope, $element, $attrs) {
      var i, c, formatSeriesData, total, othersGroupCnt, otherGroup, newData, type, facet, chartsDefaults;

      formatSeriesData = function (seriesData) {
        // Default to 5%
        if (angular.isDefined($scope.groupPercent) === false) {
          $scope.groupPercent = 5;
        }

        var data = seriesData;

        if (angular.isDefined(data) &amp;&amp; data.length &gt; 0) {
          total = 0;
          othersGroupCnt = 0;
          otherGroup = [];
          newData = [];
          type = data[0].type;
          facet = data[0].facet;

          for (i = 0; i &lt; data.length; i++) {
            if (data[i].name !== null) {
              data[i].term = data[i].name;
              total += data[i].y;
            } else {
              data[i].term = null;
            }
          }

          // Aggregate the interactive terms together so they can be applied on click event.
          for (i = 0; i &lt; data.length; i++) {
            if (data[i].term !== null) {
              if (data[i].y / total &lt; $scope.groupPercent / 100) {
                othersGroupCnt += data[i].y;
                otherGroup.push(data[i].term);
              } else {
                newData.push(data[i]);
              }
            } else {
              data[i].color = &#039;#E0E0E0&#039;;
              newData.push(data[i]);
            }
          }

          // Replace series if &#039;others&#039; has 2 or more, and less than data.length items
          if (otherGroup.length &gt; 1 &amp;&amp; otherGroup.length &lt; data.length) {
            newData.push({
              name: &#039;Others (&#039; + otherGroup.length + &#039; &#039; + $attrs.heading + &#039;)&#039;,
              color: &#039;#999&#039;,
              y: othersGroupCnt,
              type: type,
              facet: facet,
              term: otherGroup
            });
          }
        }
        return newData;
      };

      chartsDefaults = {
        credits: {enabled: false},
        chart: {
          renderTo: $element[0],
          type: &#039;pie&#039;,
          spacingTop: 2,
          spacingBottom: 2,
          marginTop: 12,
          height: $attrs.height || null,
          width: $attrs.width || null
        },
        title: {
          text: $attrs.heading,
          margin: 5
        },
        plotOptions: {
          pie: {
            borderWidth: 1,
            animation: true,
            cursor: &#039;pointer&#039;,
            showInLegend: false,
            events: {
              click: function (e) {
//                if ($scope.items.length &gt; 1) {
//                  $rootScope.$broadcast(&#039;global:&#039; + $rootScope.page + &#039;:filters:set:terms&#039;, {
//                    type: e.point.type,
//                    facet: e.point.facet,
//                    terms: e.point.term
//                  });
//                } else {
//                  $rootScope.$broadcast(&#039;global:&#039; + $rootScope.page + &#039;:filters:remove:term&#039;, {
//                    type: e.point.type,
//                    facet: e.point.facet,
//                    term: e.point.term
//                  });
//                }
                Facets.toggleTerm({
                  type: e.point.type,
                  facet: e.point.facet,
                  term: e.point.name
                });
                $scope.$apply();
              }
            },
            dataLabels: {
              enabled: false,
              distance: 10,
              connectorPadding: 7,
              formatter: function () {
                if (this.point.percentage &gt; 5) {
                  if (this.point.y &gt; 999) {
                    var v = this.point.y.toString();
                    v = v.substring(0, v.length - 3);
                    return $filter(&#039;number&#039;)(v) + &#039;k&#039;;
                  } else {
                    return $filter(&#039;number&#039;)(this.point.y);
                  }
                }
              }
            }
          }
        },
        tooltip: {
          shared: true,
          enabled: true,
          formatter: function () {
            var name = this.point.term ? $filter(&#039;trans&#039;)(this.point.name, true) : &#039;No Data&#039;;
            return &#039;&lt;div class=&quot;t_hc_tooltip&quot;&gt;&#039; +
                &#039;&lt;strong&gt;&#039; + name + &#039;&lt;/strong&gt;&lt;br/&gt;&#039; +
                Highcharts.numberFormat(this.point.y, 0) + &#039; &#039; + this.series.name +
                &#039;&lt;/div&gt;&#039;;
          }
        },
        series: [
          {
            type: &#039;pie&#039;,
            size: &#039;90%&#039;,
            name: $attrs.label,
            data: formatSeriesData($scope.items)
          }
        ]
      };

      $scope.$watch(&#039;items&#039;, function (newValue, oldValue) {
        if (!newValue || angular.equals(newValue, oldValue)) {
          return;
        }
        c.series[0].setData(formatSeriesData(newValue), true);
      });

      c = new Highcharts.Chart(chartsDefaults);

      $scope.$on(&#039;$destroy&#039;, function () {
        c.destroy();
      });
    }
  };
});

angular.module(&#039;highcharts.directives&#039;).directive(&#039;donut&#039;, function ($rootScope, $filter, $state, Facets) {
  return {
    restrict: &#039;E&#039;,
    replace: true,
    scope: {
      items: &#039;=&#039;,
      subTitle: &#039;@&#039;
    },
    template: &#039;&lt;div id=&quot;container&quot; style=&quot;margin: 0 auto&quot;&gt;not working&lt;/div&gt;&#039;,
    link: function ($scope, $element, $attrs) {
      var c, renderChart, chartsDefaults, filter;

      renderChart = function (settings) {
        if (c) {
          c.destroy();
        }
        c = new Highcharts.Chart(settings);
      };

      chartsDefaults = {
        credits: {enabled: false},
        chart: {
          renderTo: $element[0],
          type: &#039;pie&#039;,
          height: $attrs.height || null,
          width: $attrs.width || null
        },
        title: {
          text: $attrs.heading
        },
        subtitle: {
          text: &#039;&#039;
        },
        plotOptions: {
          pie: {
            allowPointSelect: false,
            borderWidth: 1,
            animation: true,
            cursor: &#039;pointer&#039;,
            showInLegend: false,
            events: {
              click: function (e) {
                if ($attrs.home) {
                  filter = &#039;filters={&quot;&#039; + e.point.type + &#039;&quot;:{&quot;&#039; + e.point.facet + &#039;&quot;:{&quot;is&quot;&#039; + &#039;&quot;:[&quot;&#039; + e.point.name +
                      &#039;&quot;]}}}&#039;;
                  var type = e.point.type;
                  var facet = e.point.facet;
                  var name = e.point.name;

                  var filters = {};
                  filters[type] = {};
                  filters[type][facet] = {};
                  filters[type][facet].is = [name];

                  $state.go(&#039;advanced&#039;, {filters: angular.toJson(filters)});
                } else {
                  Facets.toggleTerm({
                    type: e.point.type,
                    facet: e.point.facet,
                    term: e.point.name
                  });
                }
                $scope.$apply();
              }
            }
          }
        },
        tooltip: {
          shared: true,
          enabled: true,
          useHTML: true,
          borderWidth: 0,
          borderRadius: 0,
          backgroundColor: &#039;none&#039;,
          shadow: false,
          formatter: function () {
            return &#039;&lt;div class=&quot;t_hc_tooltip&quot;&gt;&#039; +
                &#039;&lt;strong&gt;&#039; + $filter(&#039;define&#039;)(this.point.name) + &#039;&lt;/strong&gt;&lt;br/&gt;&#039; +
                Highcharts.numberFormat(this.point.y, 0) + &#039; &#039; + this.series.name +
                &#039;&lt;/div&gt;&#039;;
          }
        },
        series: [
          {
            name: $attrs.innerLabel,
            size: &#039;99%&#039;,
            dataLabels: {
              enabled: false,
              color: &#039;#fff&#039;,
              connectorColor: &#039;#000000&#039;,
//              distance: -25,
              zIndex: 0,
              formatter: function () {
                if (this.point.percentage &gt; 5) {
                  return this.point.y;// + &#039;&lt;b&gt;(&#039; + this.point.percentage.toFixed(2) + &#039;% )&lt;/b&gt;&#039;;
                }
              }
            }
          },
          {
            name: $attrs.outerLabel,
            //data: $scope.items.outer,
            size: &#039;120%&#039;,
            innerSize: &#039;95%&#039;,
            dataLabels: {
              enabled: false,
//              distance: 15,
              overflow: &#039;justify&#039;,
              formatter: function () {
                if (this.point.percentage &gt; 3) {
                  return this.point.y;// + &#039;&lt;b&gt;(&#039; + this.point.percentage.toFixed(2) + &#039;% )&lt;/b&gt;&#039;;
                }
              }
            }
          }
        ]
      };

      $scope.$watch(&#039;items&#039;, function (newValue) {
        var deepCopy, newSettings;
        if (!newValue) {
          return;
        }

        // We need deep copy in order to NOT override original chart object.
        // This allows us to override chart data member and still the keep
        // our original renderTo will be the same
        deepCopy = true;
        newSettings = {};
        jQuery.extend(deepCopy, newSettings, chartsDefaults);
        newSettings.series[0].data = newValue.inner;
        newSettings.series[1].data = newValue.outer;

        newSettings.subtitle.text = $scope.subTitle;

        renderChart(newSettings);
      });

      renderChart(chartsDefaults);

      $scope.$on(&#039;$destroy&#039;, function () {
        c.destroy();
      });
    }
  };
});

angular.module(&#039;highcharts.directives&#039;).directive(&#039;bar&#039;, function ($location) {
  return {
    restrict: &#039;E&#039;,
    replace: true,
    scope: {
      items: &#039;=&#039;
    },
    template: &#039;&lt;div id=&quot;container&quot; style=&quot;margin: 0 auto&quot;&gt;not working&lt;/div&gt;&#039;,
    link: function ($scope, $element, $attrs) {
      var c, renderChart, chartsDefaults;

      renderChart = function (settings) {
        if (c) {
          c.destroy();
        }
        c = new Highcharts.Chart(settings);
      };

      chartsDefaults = {
        credits: {enabled: false},
        chart: {
          renderTo: $element[0],
          type: &#039;column&#039;,
          height: $attrs.height || null,
          width: $attrs.width || null
        },
        title: {
          text: $attrs.title
        },
        xAxis: {
          labels: {
            rotation: -45,
            align: &#039;right&#039;,
            x: 10,
            formatter: function () {
              if (this.value.length &gt; 15) {
                return this.value.substring(0, 15) + &#039;...&#039;;
              } else {
                return this.value;
              }
            }
          },
          categories: angular.isDefined($scope.items) ? $scope.items.x : []
        },
        tooltip: {
          shared: true,
          enabled: true,
          useHTML: true,
          borderWidth: 0,
          borderRadius: 0,
          backgroundColor: &#039;none&#039;,
          shadow: false,
          formatter: function () {
            var num;
            if ($attrs.format &amp;&amp; $attrs.format === &#039;percentage&#039;) {
              num = Number(this.y * 100).toFixed(2);
            } else {
              num = this.y;
            }

            return &#039;&lt;div class=&quot;t_hc_tooltip&quot;&gt;&#039; +
                &#039;&lt;strong&gt;&#039; + this.x + &#039;&lt;/strong&gt;&lt;br/&gt;&#039; +
                num + &#039; &#039; + $attrs.ylabel +
                &#039;&lt;/div&gt;&#039;;
          }
        },
        yAxis: {
          //allowDecimals:false,
          min: 0,
          showFirstLabel: true,
          showLastLabel: true,
          title: {
            text: $attrs.ylabel
          },
          labels: {
            enabled: true,
            formatter: function () {
              if ($attrs.format === &#039;percentage&#039;) {
                return this.value * 100;
              }
              return this.value;
            }
          }
        },
        series: angular.isDefined($scope.items) ? [
          {data: $scope.items.s}
        ] : [
          {data: []}
        ],
        plotOptions: {
          column: {
            events: {
              click: function (e) {
                if (e.point.link) {
                  $location.path(e.point.link);
                  $scope.$apply();
                }
              }
            }
          }
        }
      };

      $scope.$watch(&#039;items&#039;, function (newValue) {
        var deepCopy, newSettings;

        if (!newValue) {
          return;
        }
        // We need deep copy in order to NOT override original chart object.
        // This allows us to override chart data member and still the keep
        // our original renderTo will be the same
        deepCopy = true;
        newSettings = {};
        jQuery.extend(deepCopy, newSettings, chartsDefaults);
        newSettings.xAxis.categories = newValue.x;

        if (!$attrs.format || $attrs.format !== &#039;percentage&#039;) {
          if (newSettings.yAxis) {
            newSettings.yAxis.allowDecimals = false;
          }
        }

        newSettings.series = [
          {data: newValue.s}
        ];
        renderChart(newSettings);
      }, true);

      renderChart(chartsDefaults);

      $scope.$on(&#039;$destroy&#039;, function () {
        c.destroy();
      });
    }
  };
});

angular.module(&#039;highcharts.directives&#039;).directive(&#039;stacked&#039;, function ($location) {
  return {
    restrict: &#039;E&#039;,
    replace: true,
    scope: {
      items: &#039;=&#039;,
      subTitle: &#039;@&#039;
    },
    template: &#039;&lt;div id=&quot;container&quot; style=&quot;margin: 0 auto&quot;&gt;not working&lt;/div&gt;&#039;,
    link: function ($scope, $element, $attrs) {
      var c, renderChart, chartsDefaults;

      renderChart = function (settings) {
        if (c) {
          c.destroy();
        }
        c = new Highcharts.Chart(settings);
      };

      chartsDefaults = {
        credits: {enabled: false},
        chart: {
          zoomType: &#039;x&#039;,
          renderTo: $element[0],
          type: &#039;column&#039;,
          height: $attrs.height || null,
          width: $attrs.width || null
        },
        subtitle: {
          text: &#039;&#039;
        },
        title: {
          text: &#039;Top 20 Mutated Genes&#039;
        },
        xAxis: {
          labels: {
            rotation: -45,
            align: &#039;right&#039;,
            x: 5
          }
        },
        yAxis: {
          allowDecimals: false,
          min: 0,
          title: {
            text: &#039;Donors Affected&#039;
          },
          labels: {
            enabled: true,
            formatter: function () {
              return this.value;
            }
          }
        },
        tooltip: {
          formatter: function () {
            var donors = this.y;

            return &#039;&lt;div class=&quot;t_hc_tooltip&quot;&gt;&#039; +
                &#039;&lt;strong&gt;&#039; + this.series.name + &#039;&lt;/strong&gt;&lt;br/&gt;&#039; +
                donors + &#039; &#039; + &#039; donors affected&#039; +
                &#039;&lt;/div&gt;&#039;;
          }
        },
        plotOptions: {
          column: {
            cursor: &#039;pointer&#039;,
            stacking: &#039;normal&#039;,
            borderWidth: 0,
            dataLabels: {
              enabled: false
            },
            events: {
              click: function (e) {
                $location.path(&#039;/genes/&#039; + e.point.gene_id).search({});
                $scope.$apply();
              }
            }
          }
        }
      };

      $scope.$watch(&#039;items&#039;, function (newValue) {
        var deepCopy, newSettings;

        if (!newValue) {
          return;
        }

        // We need deep copy in order to NOT override original chart object.
        // This allows us to override chart data member and still the keep
        // our original renderTo will be the same
        deepCopy = true;
        newSettings = {};
        jQuery.extend(deepCopy, newSettings, chartsDefaults);
        newSettings.xAxis.categories = newValue.x;
        newSettings.series = newValue.s;

        newSettings.subtitle.text = $scope.subTitle;

        renderChart(newSettings);
      }, true);

      renderChart(chartsDefaults);

      $scope.$on(&#039;$destroy&#039;, function () {
        c.destroy();
      });
    }
  };
});

//angular.module(&#039;highcharts.directives&#039;).directive(&#039;stackedtoggle&#039;, function(httpService) {
//  return {
//    restrict: &#039;E&#039;,
//    replace: true,
//    scope: false,
//    template: &#039;&lt;div class=&quot;btn-group&quot;&gt;&#039; +
//      &#039;&lt;button ng-click=&quot;onClick(\&#039;total\&#039;)&quot; ng-class=&quot;{active: active==\&#039;total\&#039;}&quot; class=&quot;btn btn-small&quot;&gt;&#039; +
//      &#039;Total&lt;/button&gt;&#039; +
//      &#039;&lt;button ng-click=&quot;onClick(\&#039;percentage\&#039;)&quot; ng-class=&quot;{active: active==\&#039;percentage\&#039;}&quot; class=&quot;btn btn-small&quot;&gt;&#039;+
//      &#039;Percentage&lt;/button&gt;&#039; +
//      &#039;&lt;/div&gt;&#039;,
//    link: function(scope) {
//      scope.$watch(function() {
//        return httpService.getCurrentSearch().score;
//      }, function(n) {
//        if (!n) {
//          scope.active = &#039;percentage&#039;;
//          return;
//        }
//        scope.active = n;
//        scope.$emit(&#039;refreshStacked&#039;);
//      });
//
//      scope.onClick = function(score_type) {
//        var search;
//        search = httpService.getCurrentSearch();
//        search.score = score_type;
//        httpService.updateSearch(search);
//      };
//    }
//  };
//});</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
