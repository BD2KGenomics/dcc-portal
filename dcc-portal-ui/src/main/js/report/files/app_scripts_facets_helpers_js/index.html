<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - app/scripts/facets/helpers.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>app/scripts/facets/helpers.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">70.19</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">298</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">68.30</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">2.27</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">/*
 * Copyright 2013(c) The Ontario Institute for Cancer Research. All rights reserved.
 *
 * This program and the accompanying materials are made available under the terms of the GNU Public
 * License v3.0. You should have received a copy of the GNU General Public License along with this
 * program. If not, see &lt;http://www.gnu.org/licenses/&gt;.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY EXPRESS OR
 * IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 * FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
 * WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY
 * WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */
(function () {
  &#039;use strict&#039;;

  var module = angular.module(&#039;icgc.facets.helpers&#039;, []);

  module.factory(&#039;Facets&#039;, function (LocationService) {

    function ensurePath(filters, params) {
      if (!filters.hasOwnProperty(params.type)) {
        filters[params.type] = {};
      }
      if (!filters[params.type].hasOwnProperty(params.facet)) {
        filters[params.type][params.facet] = {is: []};
      }
    }

    /*
     * TODO Set Terms
     */
    function setTerms(params) {
      var filters;

      // Check for required parameters
      [&#039;type&#039;, &#039;facet&#039;, &#039;terms&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp) || !angular.isDefined(params[rp])) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      filters = LocationService.filters();

      ensurePath(filters, params);

      // TODO make is possible to use &#039;is&#039; or &#039;not&#039;
      filters[params.type][params.facet].is = angular.isArray(params.terms) ? params.terms : [params.terms];
    }

    /*
     * Add a Term
     */
    function addTerm(params) {
      var filters;

      // Check for required parameters
      [ &#039;type&#039;, &#039;facet&#039;, &#039;term&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp)) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      filters = LocationService.filters();

      ensurePath(filters, params);

      // TODO make is possible to use &#039;is&#039; or &#039;not&#039;
      if (filters[params.type][params.facet].is.indexOf(params.term) === -1) {
        filters[params.type][params.facet].is.push(params.term);
      }

      LocationService.setFilters(filters);
    }

    /*
     * Remove a Term
     */
    function removeTerm(params) {
      var filters, index;

      // Check for required parameters
      [ &#039;type&#039;, &#039;facet&#039;, &#039;term&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp)) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      filters = LocationService.filters();

      // TODO make is possible to use &#039;is&#039; or &#039;not&#039;
      index = filters[params.type][params.facet].is.indexOf(params.term);
      filters[params.type][params.facet].is.splice(index, 1);

      if (!filters[params.type][params.facet].is.length) {
        removeFacet(params);
      } else {
        LocationService.setFilters(filters);
      }
    }

    /*
     * Removes a facet
     */
    function removeFacet(params) {
      var filters;

      [ &#039;type&#039;, &#039;facet&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp)) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      filters = LocationService.filters();
      delete filters[params.type][params.facet];

      if (_.isEmpty(filters[params.type])) {
        delete filters[params.type];
      }

      if (_.isEmpty(filters)) {
        LocationService.removeFilters();
      } else {
        LocationService.setFilters(filters);
      }
    }

    /*
     * Removes all filters
     */
    function removeAll() {
      LocationService.removeFilters();
    }

    /*
     * TODO Toggle Term
     */
    function toggleTerm(params) {
      var filters;

      [ &#039;type&#039;, &#039;facet&#039;, &#039;term&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp)) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      filters = LocationService.filters();
      console.info(filters);
      if (filters.hasOwnProperty(params.type) &amp;&amp;
          filters[params.type].hasOwnProperty(params.facet) &amp;&amp;
        // TODO support is/not
          filters[params.type][params.facet].is.indexOf(params.term) !== -1) {
        removeTerm(params);
      } else {
        addTerm(params);
      }
    }

    /*
     * Get list of active terms
     */
    function getActiveTerms(params) {
      var filters, list = [];

      [ &#039;type&#039;, &#039;facet&#039;, &#039;terms&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp)) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      filters = LocationService.filters();

      function filterFn(active) {
        return _.findWhere(params.terms, function (term) {
          return term.term === active;
        }) || { term: active, count: 0};
      }

      if (filters.hasOwnProperty(params.type) &amp;&amp; filters[params.type].hasOwnProperty(params.facet)) {
        // TODO make is possible to use &#039;is&#039; or &#039;not&#039;
        list = _.map(filters[params.type][params.facet].is, filterFn);
      }

      return list;
    }

    /*
     * Get list of inactive terms
     */
    function getInactiveTerms(params) {
      [ &#039;actives&#039;, &#039;terms&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp)) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      return _.difference(params.terms, params.actives);
    }

    /* Get a list of active tags */
    function getActiveTags(params) {
      var filters, list = [];

      [ &#039;type&#039;, &#039;facet&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp)) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      filters = LocationService.filters();

      if (filters.hasOwnProperty(params.type) &amp;&amp; filters[params.type].hasOwnProperty(params.facet)) {
        // TODO make is possible to use &#039;is&#039; or &#039;not&#039;
        list = filters[params.type][params.facet].is;
      }

      return list;
    }

    /* Get a list of active tags */
    function getActiveLocations(params) {
      var filters, list = [];

      [ &#039;type&#039;, &#039;facet&#039;].forEach(function (rp) {
        if (!params.hasOwnProperty(rp)) {
          throw new Error(&#039;Missing required parameter: &#039; + rp);
        }
      });

      filters = LocationService.filters();

      if (filters.hasOwnProperty(params.type) &amp;&amp; filters[params.type].hasOwnProperty(params.facet)) {
        // TODO make is possible to use &#039;is&#039; or &#039;not&#039;
        list = filters[params.type][params.facet].is;
      }

      return list;
    }

    return {
      setTerms: setTerms,
      toggleTerm: toggleTerm,
      addTerm: addTerm,
      removeTerm: removeTerm,
      removeFacet: removeFacet,
      removeAll: removeAll,
      getActiveTerms: getActiveTerms,
      getInactiveTerms: getInactiveTerms,
      getActiveTags: getActiveTags,
      getActiveLocations: getActiveLocations
    };
  });

  module.directive(&#039;facetList&#039;, function () {
    return {
      restrict: &#039;A&#039;,
      replace: true,
      transclude: true,
      template: &#039;&lt;ul class=&quot;t_sh&quot;&gt;&#039; +
          &#039;&lt;li&gt;&lt;ul ng-transclude&gt;&lt;/ul&gt;&lt;/li&gt;&#039; +
          &#039;&lt;li ng-if=&quot;show&quot; class=&quot;t_sh__toggle&quot;&gt;&#039; +
          &#039;&lt;a ng-click=&quot;toggle()&quot; href=&quot;&quot; class=&quot;t_tools__tool&quot;&gt;&#039; +
          &#039;&lt;span ng-if=&quot;!expanded&quot;&gt;&lt;i class=&quot;icon-caret-down&quot;&gt;&lt;/i&gt; {{ more }} more&lt;/span&gt;&#039; +
          &#039;&lt;span ng-if=&quot;expanded&quot;&gt;&lt;i class=&quot;icon-caret-up&quot;&gt;&lt;/i&gt; less&lt;/span&gt;&#039; +
          &#039;&lt;/a&gt;&#039; +
          &#039;&lt;/li&gt;&lt;/ul&gt;&#039;,
      link: function (scope, elem, attrs) {
        var previous, next, limit;

        // How many items to show in collapsed list
        limit = attrs.limit ? parseInt(attrs.limit, 10) : 1;

        function swap() {
          previous = [next, next = previous][0];
        }

        function list(value) {
          scope.list = value;
          // How many items are hidden
          scope.more = scope.list.length - limit;
          // If there is more than 1 item in the collapsed list show toggle
          scope.show = scope.more &gt; 1;

          previous = scope.list;
          next = scope.show ? scope.list.slice(0, limit) : scope.list;

          // If list updates while expanded
          if (scope.expanded) {
            swap();
          }

          scope.list = next;
        }

        scope.toggle = function () {
          scope.expanded = !scope.expanded;
          swap();
          scope.list = next;
        };

        // Need to use observe instead of scope so list still
        // has access to parent scope events
        attrs.$observe(&#039;facetList&#039;, function (value) {
          if (value) {
            list(JSON.parse(value));
          }
        });
      }
    };
  });
})();</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
