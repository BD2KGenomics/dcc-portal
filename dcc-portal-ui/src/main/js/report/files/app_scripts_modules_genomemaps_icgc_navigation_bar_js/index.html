<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title></title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap-3.0.0-wip.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome-ie7.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="brand" href="http://github.com/jsoverson/plato">Plato on Github</a>
    <ul class="nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>app/scripts/modules/genomemaps/icgc-navigation-bar.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="span6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"></i></a></h2>
      <p class="stat">69.88</p>
    </div>
    <div class="span6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC"></i></h2>
      <p class="stat">219</p>
    </div>
  </div>
  <div class="row historical">
    <div class="span6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="span6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="span6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty"></i></a></h2>
      <p class="stat">34.99</p>
    </div>
    <div class="span6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs"></i></a></h2>
      <p class="stat">2.37</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="span6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="span6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="span12">/*
 * Copyright (c) 2012 Francisco Salavert (ICM-CIPF)
 * Copyright (c) 2012 Ruben Sanchez (ICM-CIPF)
 * Copyright (c) 2012 Ignacio Medina (ICM-CIPF)
 *
 * This file is part of JS Common Libs.
 *
 * JS Common Libs is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 2 of the License, or
 * (at your option) any later version.
 *
 * JS Common Libs is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with JS Common Libs. If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */

function IcgcNavigationBar(args) {

    // Using Underscore &#039;extend&#039; function to extend and add Backbone Events
    _.extend(this, Backbone.Events);

    var _this = this;

    this.id = Utils.genId(&quot;IcgcNavigationBar&quot;);

    this.species = &#039;Homo sapiens&#039;;
    this.increment = 3;
    this.zoom;

    //set instantiation args, must be last
    _.extend(this, args);

    //set new region object
    this.region = new Region(this.region);

    this.currentChromosomeList = [];

    this.on(this.handlers);

    this.rendered = false;
    if (this.autoRender) {
        this.render();
    }
};

IcgcNavigationBar.prototype = {

    render: function (targetId) {
        var _this = this;
        this.targetId = (targetId) ? targetId : this.targetId;
        if ($(&#039;#&#039; + this.targetId).length &lt; 1) {
            console.log(&#039;targetId not found in DOM&#039;);
            return;
        }

        var navgationHtml =
            &#039;&lt;a id=&quot;restoreDefaultRegionButton&quot; class=&quot;btn btn-mini btn-primary&quot;&gt;&lt;i class=&quot;icon-repeat&quot;&gt;&lt;/i&gt;&lt;/a&gt; &#039; +
                &#039;&lt;div class=&quot;btn-group&quot;&gt;&#039;+
                &#039;&lt;button id=&quot;regionHistorybutton&quot; class=&quot;btn btn-mini btn-primary dropdown-toggle&quot; data-toggle=&quot;dropdown&quot;&gt;&lt;i class=&quot;icon-time&quot;&gt; &amp;nbsp;&lt;/i&gt;&lt;span class=&quot;caret&quot;&gt;&lt;/span&gt;&lt;/button&gt;&#039; +
                &#039;&lt;ul id=&quot;regionHistoryMenu&quot; class=&quot;dropdown-menu&quot;&gt;&lt;/ul&gt;&#039; +
                &#039;&lt;/div&gt; &amp;nbsp;&#039;+
                &#039;&lt;a id=&quot;zoomOutButton&quot; class=&quot;btn btn-mini btn-primary&quot;&gt;&lt;i class=&quot;icon-minus&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#039; +
                &#039;&lt;span style=&quot;margin:0 15px&quot;&gt;&lt;div id=&quot;slider&quot; style=&quot;width:100px&quot; &gt;&lt;/div&gt;&lt;/span&gt;&#039; +
                &#039;&lt;a id=&quot;zoomInButton&quot; class=&quot;btn btn-mini btn-primary&quot;&gt;&lt;i class=&quot;icon-plus&quot;&gt;&lt;/i&gt;&lt;/a&gt; &#039; +
//                &#039;&lt;a id=&quot;fullScreenButton&quot; class=&quot;btn btn-mini btn-primary&quot; style=&quot;margin-left: 10px&quot;&gt;&lt;i class=&quot;icon-fullscreen&quot;&gt;&lt;/i&gt;&lt;/a&gt; &#039; +
            &#039;&lt;a id=&quot;resizeSmallButton&quot; class=&quot;btn btn-mini btn-primary&quot;&gt;&lt;i class=&quot;icon-resize-small&quot;&gt;&lt;/i&gt;&lt;/a&gt; &#039; +
            &#039;&lt;a id=&quot;resizeBigButton&quot; class=&quot;btn btn-mini btn-primary&quot;&gt;&lt;i class=&quot;icon-resize-full&quot;&gt;&lt;/i&gt;&lt;/a&gt;&#039; +
            &#039;&#039;;

//        icon-repeat
        this.targetDiv = $(&#039;#&#039; + this.targetId)[0];
        this.div = $(&#039;&lt;div id=&quot;navigation-bar&quot; class=&quot;gv-navigation-bar unselectable&quot;&gt;&#039; + navgationHtml + &#039;&lt;/div&gt;&#039;)[0];
        $(this.targetDiv).append(this.div);


        this.restoreDefaultRegionButton = $(this.div).find(&#039;#restoreDefaultRegionButton&#039;);
        $(this.restoreDefaultRegionButton).click(function (e) {
            _this.trigger(&#039;restoreDefaultRegion:click&#039;,{clickEvent:e,sender:{}})
        });


        this.regionHistoryMenu = this.regionHistoryMenu = $(this.div).find(&#039;#regionHistoryMenu&#039;);
//        this.regionHistorybutton = this.regionHistoryMenu = $(this.div).find(&#039;#regionHistoryButton&#039;);
        this._addRegionHistoryMenuItem(this.region);

        this.zoomSlider = $(this.div).find(&quot;#slider&quot;);
        $(this.zoomSlider).slider({
            min: 0,
            max: 100,
            value: this.zoom,
            step: 0.000001,
            tooltip:&#039;hide&#039;
        }).on(&#039;slideStop&#039;, function(ev){
                _this._handleZoomSlider(ev.value);
            });

//        {
//            range: &quot;min&quot;,
//            value: this.zoom,
//            min: 0,
//            max: 100,
//            step: Number.MIN_VALUE,
//            stop: function (event, ui) {
//                _this._handleZoomSlider(ui.value);
//            }
//        });

//        $(&#039;#foo&#039;).slider().on();


        this.zoomInButton = $(this.div).find(&#039;#zoomInButton&#039;);
        this.zoomOutButton = $(this.div).find(&#039;#zoomOutButton&#039;);
        $(this.zoomOutButton).click(function () {
            _this._handleZoomOutButton();
        });
        $(this.zoomInButton).click(function () {
            _this._handleZoomInButton();
        });

//        this.fullScreenButton = $(this.div).find(&#039;#fullScreenButton&#039;);
//        $(this.fullScreenButton).click(function (e) {
//            _this.trigger(&#039;fullscreen:click&#039;,{clickEvent:e,sender:_this})
//        });

        this.resizeBigButton = $(this.div).find(&#039;#resizeBigButton&#039;);
        $(this.resizeBigButton).click(function () {
            _this.trigger(&#039;size:big&#039;,{sender:_this})
        });
        this.resizeSmallButton = $(this.div).find(&#039;#resizeSmallButton&#039;);
        $(this.resizeSmallButton).click(function () {
            _this.trigger(&#039;size:small&#039;,{sender:_this})
        });

        this.rendered = true;
    },
    draw: function () {
        if (!this.rendered) {
            console.info(this.id + &#039; is not rendered yet&#039;);
            return;
        }
    },

    _addRegionHistoryMenuItem: function (region) {
        var _this = this;
        var menuEntry = $(&#039;&lt;li&gt;&lt;a tabindex=&quot;-1&quot;&gt;&#039;+region.toString()+&#039;&lt;/a&gt;&lt;/li&gt;&#039;)[0];
        $(this.regionHistoryMenu).append(menuEntry);
        $(menuEntry).click(function () {
            _this.region.parse($(this).text());
            _this._recalculateZoom();
            _this.trigger(&#039;region:change&#039;, {region: _this.region, sender: _this});
            console.log($(this).text());
        });
    },


    _handleZoomOutButton: function () {
        this._handleZoomSlider(Math.max(0, this.zoom - 1));
        $(this.zoomSlider).slider(&quot;setValue&quot;, this.zoom);
    },
    _handleZoomSlider: function (value) {
        this.zoom = value;
        this.region.load(this._calculateRegionByZoom());
        $(this.regionField).val(this.region.toString());
        this._addRegionHistoryMenuItem(this.region);
        this.trigger(&#039;region:change&#039;, {region: this.region, sender: this});
    },
    _handleZoomInButton: function () {
        this._handleZoomSlider(Math.min(100, this.zoom + 1));
        $(this.zoomSlider).slider(&quot;setValue&quot;, this.zoom);
    },


    setVisible: function (obj) {
        for (key in obj) {
            var query = $(this.div).find(&#039;#&#039; + key);
            if (obj[key]) {
                query.css({display: &#039;inline-block&#039;})
            } else {
                query.css({display: &#039;none&#039;})
            }
        }
    },

    setRegion: function (region) {
        this.region.load(region);
        $(this.chromosomeText).text(this.region.chromosome);
        $(this.regionField).val(this.region.toString());
        this._recalculateZoom();
        this._addRegionHistoryMenuItem(region);

    },
    moveRegion: function (region) {
        this.region.load(region);
        $(this.chromosomeText).text(this.region.chromosome);
        $(this.regionField).val(this.region.toString());
        this._recalculateZoom();
    },
    setWidth: function (width) {
        this.width = width;
        this._recalculateZoom();
    },

    _recalculateZoom: function () {
        console.log(this.zoom)
        this.zoom = this._calculateZoomByRegion();
        console.log(this.zoom)
        $(this.zoomSlider).slider(&quot;setValue&quot;, this.zoom);
    },

    _calculateRegionByZoom: function () {
        var zoomBaseLength = (this.width - this.svgCanvasWidthOffset) / Utils.getPixelBaseByZoom(this.zoom);
        var centerPosition = this.region.center();
        var aux = Math.ceil((zoomBaseLength / 2) - 1);
        var start = Math.floor(centerPosition - aux);
        var end = Math.floor(centerPosition + aux);
        return {start: start, end: end};
    },
    _calculateZoomByRegion: function () {
        return Utils.getZoomByPixelBase((this.width - this.svgCanvasWidthOffset) / this.region.length());
    },
    setVisible: function (obj) {
        for (key in obj) {
            var query = $(this.div).find(&#039;#&#039; + key);
            if (obj[key]) {
                query.show();
            } else {
                query.hide();
            }
        }
    },
    setFullScreenButtonVisible: function (bool) {
        this.fullscreenButton.setVisible(bool);
    }

}</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
