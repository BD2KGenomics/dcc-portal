<aside class="t_sidebar">
  <div style="position: relative; margin-right: -2rem">
    <ul class="t_facets">
      <li data-tags-facet
          data-type="file"
          data-facet-name="id"
          data-proxy-type="file"
          data-proxy-facet-name="id"
          data-label="File"
          data-placeholder="Enter file ID, name, or object ID" ></li>
      <li data-tags-facet
          data-type="file-donor"
          data-facet-name="id"
          data-label="Donor"
          data-placeholder="e.g. DO45299, SA501608"
          data-proxy-type="file"
          data-proxy-facet-name="donorId"></li>

      <terms data-type="file" data-facet-name="projectCode"
             data-label="Project"
             data-facet="ExternalRepoController.files.termFacets.projectCode"
             data-defined="true"></terms>
      <terms data-type="file" data-facet-name="primarySite"
             data-label="Primary Site"
             data-facet="ExternalRepoController.files.termFacets.primarySite"></terms>
      <terms data-type="file" data-facet-name="specimenType"
             data-facet="ExternalRepoController.files.termFacets.specimenType"
             data-label="Specimen Type"></terms>
      <terms data-type="file" data-facet-name="repoName"
             data-facet="ExternalRepoController.files.termFacets.repoName"
             data-label="Repository"></terms>
      <terms data-type="file" data-facet-name="dataType"
             data-label="Data Type"
             data-facet="ExternalRepoController.files.termFacets.dataType"></terms>
      <terms data-type="file" data-facet-name="experimentalStrategy"
             data-label="Experimental Strategy"
             data-facet="ExternalRepoController.files.termFacets.experimentalStrategy"
             data-defined="true"></terms>
      <terms data-type="file" data-facet-name="study"
             data-label="Only Files in Study"
             data-missing-text="None"
             data-facet="ExternalRepoController.files.termFacets.study"></terms>
      <terms data-type="file" data-facet-name="fileFormat"
             data-label="File Format"
             data-facet="ExternalRepoController.files.termFacets.fileFormat"></terms>
      <terms data-type="file" data-facet-name="access"
             data-label="Access"
             data-facet="ExternalRepoController.files.termFacets.access"></terms>
      <terms data-type="file" data-facet-name="donorStudy"
             data-label="Only Donors in Study"
             data-missing-text="None"
             data-facet="ExternalRepoController.files.termFacets.donorStudy"></terms>
    </ul>
  </div>
</aside>

<article style="position: relative;">
    <current></current>
    <section style="padding-top:0">
        <div>
           <!--
           <p>
               ICGC raw data and other data are available in other repositories. You can use this search tool to find
               files of your interest and create repository-specific manifests. Some manifests may require
               <a href="https://docs.icgc.org/access-controlled-data" target="_blank"><i class="icon-external-link"></i>authorized</a> access.
               <br>
               -->
            </p>
        </div>
        <div class="empty loading-text" data-ng-if="ExternalRepoController.files.hits.length === 0">
            <h3>No Files Found</h3>
        </div>
        <div data-ng-if="ExternalRepoController.files.hits.length">

            <section class="well" style="padding-top:0.5rem; padding-bottom:0.5rem">
                <div class="quarter">
                    <button class="t_button" data-ng-click="ExternalRepoController.downloadManifest()">
                      <i class="icon-download"></i>Download manifests
                    </button>
                </div>
                <div class="quarter">
                    <i class="icon-file" style="font-size:1.25rem"></i>
                    <strong>{{ExternalRepoController.summary.fileCount | number}}</strong> Files
                </div>
                <div class="quarter">
                    <i class="icon-team" style="font-size:1.25rem"></i>
                    <a href="" data-ng-click="ExternalRepoController.viewInSearch(ExternalRepoController.summary.fileCount)" >
                      <strong>
                        {{ExternalRepoController.summary.donorCount | number}}
                      </strong> Donors
                    </a>
                </div>
                <div class="quarter omega">
                    <i class="icon-database" style="font-size:1.25rem"></i>
                    <strong>{{ExternalRepoController.summary.totalFileSize | bytes}}</strong>
                </div>
            </section>
            <div class="clearfix"></div>

            <span class="action-toolbar pull-right">
              <span class="action-item">
                  <i class="icon-floppy"></i><a href="" data-ng-click="ExternalRepoController.saveDonorSet('donor', ExternalRepoController.summary.donorCount)">Save Donor Set</a>
              </span>
            </span>

            <div class="t_table_top">
                <span data-table-counts data-label="files" data-page="ExternalRepoController.files.pagination"></span>
                <span class="t_tools">
                    <span class="t_tools__tool">
                        <i class="icon-file pull-right"
                           data-tooltip="Export table as TSV" data-tooltip-placement="left"
                           data-ng-click="ExternalRepoController.export()"></i>
                    </span>
                </span>
            </div>

            <table class="table table-selectable">
                <thead>
                    <th>&nbsp;</th>
                    <th data-sortable data-type="files" data-field="id"
                      data-active="true" data-reversed="true">File ID</th>

                    <th data-sortable data-type="files" data-field="donorId">Donor</th>

                    <th>Repository</th>

                    <th data-sortable data-type="files" data-field="projectCode">Project</th>

                    <th>Study</th>
                    <th data-sortable data-type="files" data-field="dataType">Data Type</th>
                    <th data-sortable data-type="files" data-field="experimentalStrategy">Strategy</th>
                    <th>Format</th>

                    <!-- <th data-sortable data-type="files" data-field="fileSize">Size</th> -->
                    <th>Size</th>

                </thead>

                <tbody>
                  <tr data-ng-repeat="row in ExternalRepoController.files.hits">
                    <td class="text-center" data-ng-click="ExternalRepoController.toggleRow (row)" style="cursor: pointer">
                     <i class="{{ ExternalRepoController.isSelected (row) ? 'icon-check' : 'icon-check-empty' }}" />
                    </td>

                    <td style="min-width: 6rem; max-width: 8rem; font-size: {{ row.fileId.length > 100? '0.75rem' : ' inherit' }}">
                       <i class="{{ row.access === 'open' ? 'icon-lock-open' : 'icon-lock' }}" />
                       <a href="/repository/external/files/{{ row.id }}"
                        tooltip="{{ ExternalRepoController.fileNames (row.fileCopies) }}">
                        {{ row.id }}
                       </a>
                    </td>

                    <td ng-init="donorData = ExternalRepoController.buildDonorInfo (row.donors)">
                      <a href="{{ donorData.href }}" tooltip="{{ donorData.tooltip}} ">
                        {{ donorData.text }}
                      </a>
                    </td>

                    <td>{{ ExternalRepoController.repoNames (row.fileCopies) }}</td>

                    <td ng-init="ProjectData = ExternalRepoController.buildProjectInfo (row.donors)">
                      <a href="{{ ProjectData.href }}" tooltip="{{ ProjectData.tooltip }}">
                        {{ ProjectData.text }}
                      </a>
                    </td>

                    <td>
                      <study-badge study="{{ row.study [0] }}" text="{{ row.study [0] }}">
                    </td>

                    <td>{{ row.dataCategorization.dataType }}</td>
                    <td>{{ row.dataCategorization.experimentalStrategy }}</td>

                    <td>{{ ExternalRepoController.fileFormats (row.fileCopies) }}</td>

                    <td style="min-width: 6rem;">{{ ExternalRepoController.fileAverageSize (row.fileCopies) | bytes }}</td>

                  </tr>
                </tbody>
            </table>
           <pagination-controls data-type="files" data-data="ExternalRepoController.files"></pagination-controls>
        </div>

        <div>
            <br>

            <small class="pull-left">
               Please see the <a href="https://docs.icgc.org/data-portal-usage#externalrepo" target="_blank"><i class="icon-external-link"></i>Repository documentation</a> resource
               for a general overview of this feature.
            </small>
            <small class="pull-right">Index updated: {{ExternalRepoController.repoCreationTime | date}}</small>
        </div>
    </section>
</article>
